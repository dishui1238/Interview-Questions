## 前端安全

### XSS

> Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击(为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS)。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。

#### XSS 分类

根据攻击的来源，XSS 攻击可分为存储型、反射型和 DOM 型三种。

1. 存储型

- 攻击者将恶意代码提交到目标网站的数据库中
- 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
- 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等

2. 反射型

- 攻击者构造出特殊的 URL，其中包含恶意代码。
- 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
- 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。

3. DOM 型 XSS

- 攻击者构造出特殊的 URL，其中包含恶意代码。
- 用户打开带有恶意代码的 URL。
- 用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
- 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。

#### XSS 攻击预防

1. 使用 HTML 转义

2. 开启 CSP 防护
   通过在 HTTP 头部中设置 `Content-Security-Policy`，就可以配置该策略，如果将 CSP 设置成一下模式：
   ```js
   Content-Security-Policy: script-src 'self'
   ```
   那么该网站将：

- 不允许内联脚本执行;
- 禁止加载外域代码;
- 禁止外域提交;

3. 设置 HttpOnly：在服务端对其设置 httpOnly，被设置了 httpOnly 的 cookie 字段无法通过 JS 获取，也就降低了 XSS 攻击时用户凭据隐私泄漏的风险

4. 输入内容长度控制
   对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。

_来源_：https://juejin.cn/post/6844903685122703367

### CSRF

> CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。

一个典型的 CSRF 攻击有着如下的流程：

- 受害者登录 `a.com`，并保留了登录凭证（Cookie）。
- 攻击者引诱受害者访问了 `b.com`。
- `b.com`向 `a.com` 发送了一个请求：`a.com/act=xx`
- `a.com` 接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求。
- `a.com` 以受害者的名义执行了 `act=xx`。
- 攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让 `a.com` 执行了自己定义的操作。

#### CSRF 预防

1. 同源检测
   CSRF 大多来自第三方网站，那么我们就直接禁止外域（或者不受信任的域名）对我们发起请求。
   服务器可以通过解析这两个 Header 中的域名，确定请求的来源域。
   ```
   Origin Header
   Referer Header
   ```
2. SameSite Cookie
   为了从源头上解决这个问题，Google 起草了一份草案来改进 HTTP 协议，那就是为 `Set-Cookie`响应头新增 Samesite 属性，它用来标明这个 Cookie 是个“同站 Cookie”，同站 Cookie 只能作为第一方 Cookie，不能作为第三方 Cookie，Samesite 有两个属性值，分别是 Strict 和 Lax

   - `Samesite=Strict`: 严格模式，表明这个 Cookie 在任何情况下都不可能作为第三方 Cookie
   - `Samesite=Lax`: 宽松模式，假如这个请求是这种请求（改变了当前页面或者打开了新页面）且同时是个 GET 请求，则这个 Cookie 可以作为第三方 Cookie

3. 验证码
